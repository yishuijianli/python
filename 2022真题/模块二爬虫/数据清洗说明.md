# 第6题：数据清洗详细说明

## 📋 任务要求

利用Pandas函数完成对书籍数据进行清洗，包括：
1. 数据缺失值处理
2. 重复数据处理
3. 异常值处理
4. 数据类型转换

## 🎯 具体任务点

### 任务点i：检查缺失数据项
- 使用 `df.isnull().sum()` 检查每列的缺失值数量
- 显示缺失值统计信息
- 找出包含缺失值的记录

### 任务点ii：对缺失"评论评分"数据项进行均值插补
- 提取评分的数值部分（例如："5星" → 5）
- 计算评分的均值
- 使用均值填充缺失的评分
- 保持原有的格式（例如：4星）

### 任务点iii：对缺失"评论作者"数据项的记录进行删除
- 使用 `df.dropna(subset=['作者'])` 删除缺失作者的记录
- 统计删除的记录数量

### 任务点iv：对冗余数据记录进行删除
- 使用 `df.drop_duplicates()` 删除重复记录
- 保留第一条记录（keep='first'）
- 统计删除的重复记录数量

### 任务点v：保存清洗后的数据
- 保存为制表符分隔的TXT文件：`./清洗数据结果.txt`
- 同时保存为CSV格式：`./data/cleaned_comments.csv`

## 📊 数据清洗流程

```
原始数据 (200条)
    ↓
添加测试脏数据
    ├─ 添加5条缺失评分
    ├─ 添加3条缺失作者
    └─ 添加5条重复记录
    ↓
脏数据 (205条)
    ↓
任务点i：检查缺失值
    ├─ 评分缺失：6条
    └─ 作者缺失：4条
    ↓
任务点ii：均值插补评分
    └─ 用4星填充6条缺失评分
    ↓
任务点iii：删除缺失作者
    └─ 删除4条记录
    ↓
任务点iv：删除重复记录
    └─ 删除4条重复记录
    ↓
清洗后数据 (197条)
    ↓
任务点v：保存数据
    ├─ ./清洗数据结果.txt
    └─ ./data/cleaned_comments.csv
```

## 💻 代码实现

### 完整版（推荐）
```bash
python data_cleaning.py
```
- 包含详细的输出信息
- 显示每个步骤的处理结果
- 提供数据清洗总结

### 简洁版
```bash
python data_cleaning_simple.py
```
- 代码简洁明了
- 适合学习和理解

## 📈 清洗效果

### 数据统计
| 项目 | 数量 |
|------|------|
| 原始数据 | 205条 |
| 缺失评分 | 6条 |
| 缺失作者 | 4条 |
| 重复记录 | 4条 |
| 清洗后数据 | 197条 |
| 删除记录 | 8条 |

### 处理方式
| 问题类型 | 处理方式 | 数量 |
|---------|---------|------|
| 缺失评分 | 均值插补（4星） | 6条 |
| 缺失作者 | 删除记录 | 4条 |
| 重复记录 | 删除重复 | 4条 |

## 🔍 关键代码说明

### 1. 检查缺失值
```python
# 检查每列的缺失值
missing_count = df.isnull().sum()
print(missing_count)

# 显示包含缺失值的记录
missing_rows = df[df.isnull().any(axis=1)]
print(missing_rows)
```

### 2. 均值插补
```python
# 提取评分数值
df['评分_数值'] = df['评分'].str.extract('(\d+)').astype(float)

# 计算均值
rating_mean = df['评分_数值'].mean()

# 填充缺失值
fill_value = f"{int(round(rating_mean))}星"
df['评分'].fillna(fill_value, inplace=True)
```

### 3. 删除缺失作者
```python
# 删除作者列为空的记录
df = df.dropna(subset=['作者'])
```

### 4. 删除重复记录
```python
# 删除重复记录，保留第一条
df = df.drop_duplicates(keep='first')
```

### 5. 保存数据
```python
# 保存为制表符分隔的TXT文件
df.to_csv('./清洗数据结果.txt', sep='\t', index=False, encoding='utf-8-sig')

# 保存为CSV文件
df.to_csv('./data/cleaned_comments.csv', index=False, encoding='utf-8-sig')
```

## 📁 输出文件

### 清洗数据结果.txt
- 格式：制表符分隔（TSV）
- 编码：UTF-8-BOM
- 位置：当前目录
- 内容：清洗后的197条记录

### cleaned_comments.csv
- 格式：CSV（逗号分隔）
- 编码：UTF-8-BOM
- 位置：./data/ 目录
- 内容：清洗后的197条记录

## 🎓 学习要点

### Pandas常用函数

1. **缺失值处理**
   - `df.isnull()` - 检查缺失值
   - `df.isnull().sum()` - 统计缺失值
   - `df.fillna()` - 填充缺失值
   - `df.dropna()` - 删除缺失值

2. **重复值处理**
   - `df.duplicated()` - 检查重复值
   - `df.drop_duplicates()` - 删除重复值

3. **数据选择**
   - `df[condition]` - 条件筛选
   - `df.loc[]` - 标签索引
   - `df.iloc[]` - 位置索引

4. **数据保存**
   - `df.to_csv()` - 保存为CSV
   - `sep='\t'` - 使用制表符分隔
   - `encoding='utf-8-sig'` - 使用UTF-8-BOM编码

### 数据清洗原则

1. **缺失值处理**
   - 数值型：均值、中位数、众数插补
   - 分类型：众数插补或删除
   - 重要字段缺失：删除记录

2. **重复值处理**
   - 完全重复：删除
   - 部分重复：根据业务规则处理

3. **异常值处理**
   - 统计方法：3σ原则、箱线图
   - 业务规则：根据实际情况判断

## 💡 扩展练习

### 1. 添加更多清洗规则
```python
# 处理异常评分（例如：评分超出1-5星范围）
df = df[df['评分_数值'].between(1, 5)]

# 处理异常日期（例如：未来日期）
df['日期'] = pd.to_datetime(df['日期'])
df = df[df['日期'] <= pd.Timestamp.now()]

# 处理空白内容
df = df[df['内容'].str.strip() != '']
```

### 2. 数据标准化
```python
# 统一评分格式
df['评分'] = df['评分'].str.replace('星', '分')

# 统一日期格式
df['日期'] = pd.to_datetime(df['日期']).dt.strftime('%Y-%m-%d')

# 去除首尾空格
df['作者'] = df['作者'].str.strip()
df['内容'] = df['内容'].str.strip()
```

### 3. 数据验证
```python
# 验证清洗后的数据
assert df.isnull().sum().sum() == 0, "仍有缺失值"
assert df.duplicated().sum() == 0, "仍有重复值"
print("数据验证通过！")
```

## 📚 参考资料

- Pandas官方文档：https://pandas.pydata.org/docs/
- 数据清洗最佳实践
- Python数据分析教程

## ✅ 任务完成检查清单

- [x] 任务点i：检查缺失数据项
- [x] 任务点ii：对缺失"评论评分"进行均值插补
- [x] 任务点iii：删除缺失"评论作者"的记录
- [x] 任务点iv：删除冗余数据记录
- [x] 任务点v：保存清洗后的数据到"清洗数据结果.txt"
- [x] 代码运行成功
- [x] 输出文件生成正确
- [x] 数据清洗效果符合预期
